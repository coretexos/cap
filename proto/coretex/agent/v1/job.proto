syntax = "proto3";

package coretex.agent.v1;

option go_package = "github.com/coretexos/cap/v2/go/coretex/agent/v1";
option java_package = "ai.coretex.cap.agent.v1";
option java_multiple_files = true;
option csharp_namespace = "coretex.Agent.V1";
option php_namespace = "coretex\\Agent\\V1";
option ruby_package = "coretex::Agent::V1";

// JobPriority represents scheduling hints.
enum JobPriority {
    JOB_PRIORITY_UNSPECIFIED = 0;
    JOB_PRIORITY_INTERACTIVE = 1;
    JOB_PRIORITY_BATCH = 2;
    JOB_PRIORITY_CRITICAL = 3;
}

// JobStatus captures lifecycle states for a job.
enum JobStatus {
    JOB_STATUS_UNSPECIFIED = 0;
    JOB_STATUS_PENDING = 1;
    JOB_STATUS_SCHEDULED = 2;
    JOB_STATUS_DISPATCHED = 3;
    JOB_STATUS_RUNNING = 4;
    JOB_STATUS_SUCCEEDED = 5;
    JOB_STATUS_FAILED = 6;
    JOB_STATUS_CANCELLED = 7;
    JOB_STATUS_DENIED = 8;
    JOB_STATUS_TIMEOUT = 9;
}

// ContextHints describe how a worker may fetch or adapt context.
message ContextHints {
    int32 max_input_tokens = 1;  // per-call token budget
    bool allow_summarization = 2; // worker may summarize input to fit
    bool allow_retrieval = 3;     // worker may retrieve using memory_id
    repeated string tags = 4;     // optional retrieval scope: logs/code/etc.
}

// Budget carries soft limits for execution.
message Budget {
    int64 max_input_tokens = 1;   // total input token budget for the job
    int64 max_output_tokens = 2;  // total output token budget for the job
    int64 max_total_tokens = 3;   // combined in/out ceiling
    int64 deadline_ms = 4;        // soft deadline for completion
}

// JobRequest represents a schedulable unit of work.
message JobRequest {
    string job_id = 1;           // globally unique job identifier
    string topic = 2;            // bus subject, e.g. job.chat.simple
    JobPriority priority = 3;    // scheduling hint
    string context_ptr = 4;      // opaque pointer to input payload
    string adapter_id = 5;       // optional specialization hint
    map<string, string> env = 6; // tenant, locale, sandbox flags, etc.
    string parent_job_id = 7;    // optional parent link
    string workflow_id = 8;      // optional workflow identifier
    int32 step_index = 9;        // optional ordering within a workflow
    string memory_id = 10;       // logical corpus id (repo/chat/kb/etc.)
    ContextHints context_hints = 11; // guidance for retrieval/summarization
    Budget budget = 12;          // soft limits for cost/time
    string tenant_id = 13;       // tenant or organization id
    string principal_id = 14;    // end-user or service identity
    map<string, string> labels = 15; // arbitrary routing/placement labels
}

// JobResult conveys the outcome of a job.
message JobResult {
    string job_id = 1;            // originating job identifier
    JobStatus status = 2;         // terminal or transitional state
    string result_ptr = 3;        // pointer to output payload
    string worker_id = 4;         // emitting worker
    int64 execution_ms = 5;       // elapsed processing time in milliseconds
    string error_code = 6;        // optional machine-readable error
    string error_message = 7;     // optional human-readable error
}
